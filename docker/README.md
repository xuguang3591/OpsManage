

1. 构建基础镜像(修改requirements.txt后需要重新构建)
   根目录下执行：
   docker build -t opsmanage-base  -f docker/Dockerfile .
   或者使用脚本：docker/build.sh

2. 修改应用配置文件conf/opsmanage.ini

3. 修改Django配置文件OpsManage/setting.py

    - 需要使用Django来访问静态文件时需要修改DEBUG = True(Django仅在调试模式下能对外提供静态文件访问)

4. 构建应用镜像

   根目录下执行：
   docker build -t opsmanage-app -f docker/Dockerfile-app .

   或者使用脚本：docker/build-app.sh

5. 构建静态文件镜像(可选)

    根目录下执行：
    docker build -t opsmanage-static -f docker/Dockerfile-static .

6. 启动容器
   mkdir -p /data/docker-vol/opsmanage   #数据卷文件夹
   chmod a+rw /data/docker-vol/opsmanage
   touch /data/docker-vol/opsmanage/id_rsa   #这个文件根据需要写入用户SSH密钥

   docker run -d --name opsmanage -p 8000:8000 \
   -v /data/docker-vol/opsmanage/id_rsa:/root/.ssh/id_rsa \
   -v /data/docker-vol/opsmanage/upload:/data/apps/opsmanage/upload \
   172.31.0.6:5000/opsmanage-app

7. 初始化数据库
    $ docker run -it --rm opsmanage-app bash
    python3 manage.py makemigrations account
    python3 manage.py makemigrations wiki
    python3 manage.py makemigrations orders
    python3 manage.py makemigrations navbar
    python3 manage.py makemigrations databases
    python3 manage.py makemigrations asset
    python3 manage.py makemigrations deploy
    python3 manage.py makemigrations cicd
    python3 manage.py makemigrations sched
    python3 manage.py makemigrations apply
    python3 manage.py migrate
    python3 manage.py createsuperuser  #创建管理员账户与密码
    (按Ctrl+P Ctrl+Q退出)

8. 访问页面
    http://<ip>:8000


